angular.module("myapp").controller("imgviddetailController",function(e,o,t,n){show_anim(),e.base_url=base_url,e.user_id=localStorage.getItem("user_id"),e.scope_portfolio_id=0,void 0!==o.p_one_detail?(e.p_one_detail=o.p_one_detail,console.log(e.p_one_detail)):(show_anim(),n.get(base_url+"/api_upload/portfolio_one/UPsdfLo-098UYdfdsH-ooesdfWu/"+t.p_id+"/"+localStorage.getItem("user_id")).success(function(o){0==o.length&&window.history.back(),o.forEach(function(o,t){o.dates=moment(o.p_date).calendar(),o.cap=Math.round(parseInt(o.p_filesize)/1048576)/100,e.scope_portfolio_id=o.member_id}),e.p_one_detail=o,console.log(e.p_one_detail)})),n.get(base_url+"/api_upload/portfolio_data/UPLo-098UYH-ooeWu/"+t.p_id+"/"+localStorage.getItem("user_id")).success(function(o){hide_anim(),e.commnet=o}).error(function(){hide_anim()})}).directive("imgviddetailDir",function(e,o,t){return{link:function(n){var a=new Snap({element:document.getElementById("content123"),disable:"left"});$("body #content123").on("click","#open-right",function(){"right"==a.state().state?a.close():a.open("right")}),$(".cv_list").on("click",".pic_open_want",function(){var e=$(this).attr("mhref");$.fancybox.open([{href:e}],{padding:0})}),e(function(){$(".cv_list").on("click",".do_like",function(){var e=$(this).parents(".extra").prev(".photo_cv").attr("p_id"),o=$(this);o.hasClass("liked")?(o.text((parseInt(o.text())-1).toString()),n.p_one_detail.forEach(function(o){o.p_id==e&&(o.l_count=parseInt(o.l_count)-1)}),o.addClass("unliked").removeClass("liked")):o.hasClass("unliked")&&(o.text((parseInt(o.text())+1).toString()),n.p_one_detail.forEach(function(o){o.p_id==e&&(o.l_count=parseInt(o.l_count)+1)}),o.addClass("liked").removeClass("unliked")),$.get(base_url+"/api_upload/toggle_like/UPLo-09dfdfd8UYH-ooudfdfs/"+localStorage.getItem("user_id")+"/"+e)});var e=JSON.parse(localStorage.getItem("user_info"));$(".cv_list").on("click",".do_comment",function(){if(""==$(".comment_text").val().trim())return void $(".comment_text").val("").focus();$(".loading_text").removeClass("none");var o=$(".form_cm1").serialize(),a=$(".comment_text").val();a=a.replace(/(<([^>]+)>)/gi,""),txt2=a.replace(/(?:\r\n|\r|\n)/g,"<br />"),$.post(base_url+"/api_upload/comment/UPLo-098UYH-oou/"+localStorage.getItem("user_id")+"/"+t.p_id,o).success(function(o){o=JSON.parse(o),$(".loading_text").addClass("none");var i={comment:a,is_active:"1",p_id:t.p_id,gender:e[0].gender,name:e[0].name,member_id:e[0].member_id,picname:e[0].picname,date:o.date,id:o.cm_id};void 0!==n.commnet?n.$apply(function(){n.commnet.push(i),n.p_one_detail[0].c_count=parseInt(n.p_one_detail[0].c_count)+1,$(".cv_one .count .comment").text(n.commnet.length)}):n.$apply(function(){n.commnet=array(i),n.p_one_detail[0].c_count=parseInt(n.p_one_detail[0].c_count)+1,$(".cv_one .count .comment").text(n.commnet.length)}),$(".comment_text").val("").focus()}).fail(function(){$(".loading_text").addClass("none"),$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none")})})}),$(".cv_list").on("click",".remove_portfolio",function(){var e=$(this).attr("p_id"),t=$(this);$("body .lpro").removeClass("none"),$.get("http://atriaweb.ir/karkhaneh/api_upload/delete_portfolio/UP234Lo-09dfdfd8sdf34-ooudfdsdffs/"+e+"/"+localStorage.getItem("user_id"),function(){$("body .lpro").addClass("none");var n=$.grep(o.portfolio,function(o){return o.p_id!=e});o.portfolio=n,t.parents(".cv_one ").slideUp(100),window.history.back()}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".video_play",function(){url=$(this).attr("video_address"),VideoPlayer.play(url)}),$(".cv_list").on("click",".porfolio_spam",function(){$("body .lpro").removeClass("none");var e=$(this).attr("p_id");$.get(base_url+"/api_upload/portfolio_violation_report/UdsfdfPLo-0df98sdfUYH-oodffu/"+localStorage.getItem("user_id")+"/"+e,function(e){n.$apply(function(){n.p_one_detail[0].report="1"}),$("body .lpro").addClass("none")}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".portfolio_unviolation",function(){$("body .lpro").removeClass("none");var e=$(this).attr("p_id");$.get(base_url+"/api_upload/portfolio_unviolation_report/UdsfsdfdfPLo-0df98sfsdfUYH-oodfdfsfu/"+localStorage.getItem("user_id")+"/"+e,function(e){$("body .lpro").addClass("none"),n.$apply(function(){n.p_one_detail[0].report=null})}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".share_btn",function(){var e=$(this).attr("share_url");share_fn(e)}),$(".cv_list").on("click",".user_remove",function(){var e=$(this).data("member_id"),o=$(this).data("cm_id"),t=$(this).data("p_id"),a=$(this).data("p_date"),i=$.grep(n.commnet,function(e){return e.id!=o});n.$apply(function(){n.commnet=i}),$(".cv_one .count .comment").text(n.commnet.length),$.get(base_url+"/api_upload/portfolio_del_cm/UdsfsdfMdfPLo1-0df98sCfsdfUYH-ooWWdfdfsfu/"+e+"/"+o+"/"+t+"/"+a)})}}}).filter("fromNow",function(){return function(e){return moment(e).calendar()}});