angular.module("myapp").controller("imgvidController",function(t,e,o){t.base_url=base_url,t.member_id=localStorage.getItem("user_id")}).directive("imgvidDir",function(t,e,o){return{link:function(e){function o(){show_anim(),$.get(base_url+"/api_upload/portfolio/UPLo-098UYH-ooeWu/"+localStorage.getItem("user_id")+"/20/"+n+"/"+localStorage.getItem("user_id"),function(o){return hide_anim(),data=JSON.parse(o),console.log(data),0==data.length?(l=1,!1):(data.forEach(function(t,e){t.p_id=parseInt(t.p_id),t.dates=moment(t.p_date).calendar(),t.cap=Math.round(parseInt(t.p_filesize)/1048576)/1024,i.push(t)}),void e.$apply(function(){void 0===e.portfolio&&(e.portfolio=i,t.portfolio=i,t.portfolio_ofset=n),n+=20,l=0}))}).fail(function(){hide_anim()})}var i=Array(),n=0,l=0,a=new Snap({element:document.getElementById("content22"),disable:"left"});$("body #content22").on("click","#open-right",function(){"right"==a.state().state?a.close():a.open("right")}),void 0===t.portfolio?o(n):(e.portfolio=t.portfolio,n=t.portfolio_ofset),$(".tool_bar_fix").on("scroll",function(){win_height=$(window).height()+400;var t=$(".tool_bar_fix"),e=t.scrollTop()+t.height(),i=$(".user_list").height();console.log(e-i,win_height),i-e<win_height&&0==l&&(l=1,o(n))});var r;$(".full_center").click(function(){$(".tool_bar_fix .submit_register").click()}),$(function(){var o=document.getElementById("uploadBtn"),i=document.getElementById("progressBar"),n=document.getElementById("progressOuter"),l=document.getElementById("mvd_img"),a=(document.getElementById("msgBox"),new ss.SimpleUpload({button:o,autoSubmit:!1,url:base_url+"api_upload/upload/UPLo-098UYH-oou/"+localStorage.getItem("user_id"),sessionProgressUrl:base_url+"progressurl/uploadProgress.php",name:"uploadfile",multipart:!0,form:l,async:!0,maxSize:102400,data:{text:$(".text_img_vid").val().replace(/(<([^>]+)>)/gi,"")},crossDomain:!0,hoverClass:"hover",allowedExtensions:["gif","png","jpg","jpeg","mp4","avi","mkv","mpeg","3gp","wmv","flv","ogg"],focusClass:"focus",responseType:"json",onProgress:function(t){$(".percent_upload,.loading_uploading").show(0),$(".percent_upload i").text(t)},startXHR:function(t,e){n.style.display="block"},onChange:function(t){isImage(t)||isVideo(t)?$(".changable_text").text("برای ذخیره فایل دکمه ی ارسال را لمس کنید ."):$(".changable_text").text("فرمت فایل انتخابی نا معتبر است .")},onSubmit:function(t,e){$(".ui-state-disabled").show(),$(".submit_register,.text_img_vid").hide(),this.setAbortBtn($(".ui-state-disabled")),this.setData({text:document.getElementById("text_img_vid").value}),this.setProgressBar(i),r=$(".text_img_vid").val(),$(".changable_text").text("در حال بارگذاری ... لطفا شکیبا باشید  ")},onComplete:function(o,i){if(setTimeout(function(){$(".mvd_img,.text_img_vid,.submit_register").show(),$(".percent_upload,.ui-state-disabled,.loading_uploading").hide(0),n.style.display="none"},100),$(".changable_text").text("ذخیره با موفقیت انجام شد ، یک فایل دیگر انتخاب کنید"),!i)return void $(".changable_text").text("خطا در آپلود - لطفا دقایقی بعد مجدد تلاش نمایید");if(i.success===!0){if(void 0!==t.portfolio){var l={c_count:null,cap:Math.round(parseInt(i.filesize)/10240)/100,dates:moment(i.date).calendar(),duration:i.duration,l_count:null,member_do_like:null,member_id:localStorage.getItem("user_id"),p_active:"1",p_date:i.date,p_filesize:i.filesize,p_id:parseInt(i.p_id),p_name:i.name,p_text:r,p_type:i.type,v_count:"0"};console.log(t.portfolio.length),e.$apply(function(){t.portfolio.push(l),e.portfolio=t.portfolio,console.log(t.portfolio.length)})}console.log(i)}else i.msg?$(".changable_text").text(i.msg):$(".changable_text").text("خطایی در هنگام آپلود رخ داده است - لطفا دقایقی بعد مجدد تلاش نمایید"),$(".mvd_img").show(),$(".percent_upload").hide(0),$(".loading_uploading").hide(0)},onAbort:function(t){$(".changable_text").text("آپلود لغو شد - یک فایل دیگر انتخاب کنید ."),$(".submit_register,.mvd_img,.text_img_vid,.submit_register").show(),$(".percent_upload,.ui-state-disabled,.loading_uploading,#progressOuter").hide(0)},onError:function(t){console.log(t),$(".changable_text").text("خطا در آپلود - لطفا ssدقایقی بعد مجدد تلاش نمایید"),$(".mvd_img").show(),$(".percent_upload").hide(0),$(".loading_uploading").hide(0)}}));$(".submit_register").click(function(){a.submit()})}),$(".cv_list").on("click",".do_like",function(){var e=$(this).parents(".extra").prev(".photo_cv").attr("p_id"),o=$(this);o.hasClass("liked")?(o.text((parseInt(o.text())-1).toString()),t.portfolio.forEach(function(t){t.p_id==e&&(t.l_count=parseInt(t.l_count)-1)}),o.addClass("unliked").removeClass("liked")):o.hasClass("unliked")&&(o.text((parseInt(o.text())+1).toString()),t.portfolio.forEach(function(t){t.p_id==e&&(t.l_count=parseInt(t.l_count)+1)}),o.addClass("liked").removeClass("unliked")),$.get(base_url+"/api_upload/toggle_like/UPLo-09dfdfd8UYH-ooudfdfs/"+localStorage.getItem("user_id")+"/"+e)}),$(".cv_list").on("click",".photo_cv",function(){var e=$(this).attr("p_id"),o=$.grep(t.portfolio,function(t){return t.p_id==e});t.p_detail=o,console.log(t.p_detail),localStorage.setItem("p_detail",JSON.stringify(t.p_detail)),window.location.hash="#/portfolio_detail/"+e}),$(".cv_list").on("click",".remove_portfolio",function(){var e=$(this).attr("p_id"),o=$(this);$("body .lpro").removeClass("none"),$.get("http://atriaweb.ir/karkhaneh/api_upload/delete_portfolio/UP234Lo-09dfdfd8sdf34-ooudfdsdffs/"+e+"/"+localStorage.getItem("user_id"),function(){$("body .lpro").addClass("none");var i=$.grep(t.portfolio,function(t){return t.p_id!=e});t.portfolio=i,o.parents(".cv_one ").slideUp(100)}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".share_btn",function(){var t=$(this).attr("share_url");share_fn(t)})}}}).filter("timeing",function(){return function(t){var e,o;return e=Math.floor(parseInt(t)),o=Math.floor(e/60),o=o>=10?o:"0"+o,e=Math.floor(e%60),e=e>=10?e:"0"+e,amin=o+":"+e,amin}}).filter("create_link",function(){return function(t){var e=new Date(t),o=e.getTime();return o}});