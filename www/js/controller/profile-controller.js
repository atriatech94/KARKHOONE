angular.module("myapp").controller("ProfileController",function(o,e,t,l){t.user_id==localStorage.getItem("user_id")&&(window.location.href="#/myprofile"),show_anim(),o.user_info=[{city:"------",description:"------------------------------",email:"------@------.--",field:"------",followers:"0",gender:"0",grade:"0",married:"0",mobile:"000000000",name:"------ ------",picname:"",state:"------",status:"0",view:"6",age:moment().format("jYYYY")}],o.portfolios=0,o.count_s1=0,o.count_s2=0,o.user_id=t.user_id,void 0!==e.profile_info&&(o.user_info=e.profile_info),o.is_chat="0",l.get(base_url+"/api_inapp/get_user_info/Att6i3-HaREWin0B3-98FFGG858HY/"+t.user_id+"/"+localStorage.getItem("user_id")).success(function(e){hide_anim(),console.log(e.user_info2),"1"==e.is_friend?null!=e.user_perms&&(console.log(e.user_perms),e.user_perms.forEach(function(o,t){if("0"==o.access_level)switch(o.perm_name){case"mobile":e.user_info[0].mobile=void 0;break;case"email":e.user_info[0].email=void 0;break;case"cv":e.user_skill=void 0;break;case"portfolio":e.user_info.portfolio=void 0;break;case"follower":e.count_follower[0].count_follower=void 0;break;case"following":e.count_following[0].count_following=void 0}})):null!=e.user_perms&&e.user_perms.forEach(function(o,t){if("2"!=o.access_level)switch(o.perm_name){case"mobile":e.user_info[0].mobile=void 0;break;case"email":e.user_info[0].email=void 0;break;case"cv":e.user_skill=void 0;break;case"portfolio":e.user_info.portfolio=void 0;break;case"follower":e.count_follower[0].count_follower=void 0;break;case"following":e.count_following[0].count_following=void 0}}),null==localStorage.getItem("user_follower")&&localStorage.setItem("user_follower","[]"),null==localStorage.getItem("user_checked")&&localStorage.setItem("user_checked","[]"),console.log("inee",e.chat_block),e.chat_block.length>1?o.is_chat="4":1==e.chat_block.length&&e.chat_block[0].user_blocked==localStorage.getItem("user_id")?o.is_chat="1":1==e.chat_block.length&&e.chat_block[0].user_do_block==localStorage.getItem("user_id")?o.is_chat="2":o.is_chat="3",o.user_info=e.user_info,o.user_skill=e.user_skill,o.user_spam=e.spam[0].count,o.portfolios=e.user_info.portfolio,o.info=e.info,o.followers=e.followers,void 0!==e.count_follower[0].count_follower&&(o.count_fllower=e.count_follower[0].count_follower),void 0!==e.count_following[0].count_following&&(o.count_fllowing=e.count_following[0].count_following),o.now_year=moment().format("jYYYY"),o.base_url=base_url,o.follower=JSON.parse(localStorage.getItem("user_follower")),o.checked=JSON.parse(localStorage.getItem("user_checked")),null!=o.user_skill&&o.user_skill.length>0&&o.user_skill.forEach(function(e,t){"0"==e[2]?o.count_s1++:o.count_s2++}),"0"==e.user_info.length&&($("body .alert .msg").text("کاربر غیر فعال می باشد .").parent(".alert").removeClass("none"),window.location.hash="#/wall")}).error(function(){hide_anim(),$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none")})}).directive("profileDir",function(o,e){return{link:function(t){function l(){show_anim(),is_req=1,$.get(base_url+"/api_upload/portfolio/UPLo-098UYH-ooeWu/"+e.user_id+"/20/"+i+"/"+localStorage.getItem("user_id"),function(e){hide_anim(),data=JSON.parse(e),data.length>0&&(data.forEach(function(o,e){o.dates=moment(o.p_date).calendar(),o.cap=Math.round(parseInt(o.p_filesize)/1048576)/100,a.push(o)}),t.$apply(function(){t.portfolio_you=a,o.portfolio_user=a,o.portfolio_user_ofset=i}),i=20+i,is_req=0)})}var i=(localStorage.getItem("user_id"),0),n=new Snap({element:document.getElementById("content47"),disable:"left"});$("body #content47").on("click","#open-right",function(){"right"==n.state().state?n.close():n.open("right")}),$(".short_info").on("click",".single_4_img",function(){var o=$(this).attr("mhref");$.fancybox.open([{href:o}],{padding:0})}),o.portfolio_user=null,t.$watch(function(o){return o.portfolios},function(){"havij"==t.portfolios&&l()}),$(".tool_bar_fix").on("scroll",function(){win_height=$(window).height()+400;var o=$(".tool_bar_fix"),e=o.scrollTop()+o.height(),t=$(".haminjouri").height();console.log(t-e,win_height),t-e<win_height&&0==is_req&&(is_req=1,l())}),console.log(o.myfollowing),$(".short_info").on("click",".circle_btn_like",function(){var e=localStorage.getItem("user_id"),l=$(this).attr("user_id");if($(this).hasClass("active")){if(void 0!==o.myfollowing){var i=$.grep(o.myfollowing,function(o){return o.member_id!=l});o.myfollowing=i}$(this).removeClass("active"),$.get(base_url+"/api_flow/dislike_user/D11sLIKOO-HaREWin0B3-98FFGG858HY/"+e+"/"+l,function(){var o=t.follower.indexOf(l);o>-1&&t.follower.splice(o,1),localStorage.setItem("user_follower",JSON.stringify(t.follower))})}else $(this).addClass("active"),$.get(base_url+"/api_flow/like_user/LIKOO-HaREWin0B3-98FFGG858HY/"+e+"/"+l,function(){t.follower.push(l),localStorage.setItem("user_follower",JSON.stringify(t.follower))})}),$(".short_info").on("click",".circle_btn_view",function(){var e=localStorage.getItem("user_id"),l=$(this).attr("user_id");if($(this).hasClass("active")){if(void 0!==o.mychecked){var i=$.grep(o.mychecked,function(o){return o.member_id!=l});o.mychecked=i}$(this).removeClass("active"),$.get(base_url+"/api_checked/dischecked_user/D11discheckedsLIKOO-HaREWin0B3-98FFGG858HY/"+e+"/"+l,function(){var o=t.checked.indexOf(l);o>-1&&t.checked.splice(o,1),localStorage.setItem("user_checked",JSON.stringify(t.checked))})}else $(this).addClass("active"),$.get(base_url+"/api_checked/checked_user/ch3ck3-dREWin0B3-98FFGG858HY/"+e+"/"+l,function(){t.checked.push(l),localStorage.setItem("user_checked",JSON.stringify(t.checked))})}),$("#content47").on("click",".circle_btn_msg",function(){"3"==$(this).attr("is_chat")?(localStorage.setItem("chat",JSON.stringify(t.user_info)),o.chat=t.user_info,window.location.hash="#/msg_detail"):"2"==$(this).attr("is_chat")||"4"==$(this).attr("is_chat")?$.fancybox.open("<div class='alert_btn'><p>این کاربر توسط شما مسدود شده . </p><button class='unblock_user'>لغو مسدودی</button><button class='noting_else' onclick='$.fancybox.close()'>بستن پنجره</button></div>",{closeBtn:!1}):"1"==$(this).attr("is_chat")&&$("body .alert .msg").text("شما امکان ارسال پیام به این کاربر را ندارید . ").parent(".alert").removeClass("none")}),$("body").on("click",".unblock_user",function(){$("body .lpro").removeClass("none"),$.fancybox.close(),$.get(base_url+"/api_upload/unblock_chat_user/D11discheckeLIKOO-HascEWin0B3-98FFGG85asc8HY/"+localStorage.getItem("user_id")+"/"+e.user_id,function(o){"2"==t.is_chat?t.$apply(function(){t.is_chat="3"}):"4"==t.is_chat&&t.$apply(function(){t.is_chat="1"}),$("body .lpro").addClass("none")}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".click_to_hide i").click(function(){var o=$(this);$(this).hasClass("fa-angle-down")?$(".want_hide").slideDown(function(){o.removeClass("fa-angle-down").addClass("fa-angle-up")}):$(".want_hide").slideUp(function(){o.removeClass("fa-angle-up").addClass("fa-angle-down")})});var a=Array(),i=0;$(".cv_list").on("click",".do_like",function(){var o=$(this).parents(".extra").prev(".photo_cv").attr("p_id"),e=$(this);e.hasClass("liked")?(e.text((parseInt(e.text())-1).toString()),t.$apply(function(){t.portfolio_you.forEach(function(e){e.p_id==o&&(e.l_count=parseInt(e.l_count)-1)})}),e.addClass("unliked").removeClass("liked")):e.hasClass("unliked")&&(e.text((parseInt(e.text())+1).toString()),t.$apply(function(){t.portfolio_you.forEach(function(e){e.p_id==o&&(e.l_count=parseInt(e.l_count)+1)})}),e.addClass("liked").removeClass("unliked")),$.get(base_url+"/api_upload/toggle_like/UPLo-09dfdfd8UYH-ooudfdfs/"+localStorage.getItem("user_id")+"/"+o)}),$(".contant_profile").on("click",".setting_link_forbidden",function(){$("body .lpro").removeClass("none"),$.get(base_url+"/api_upload/unviolation_report/UdasfPLo-098sdafUYH-oodafu/"+localStorage.getItem("user_id")+"/"+t.user_info[0].member_id,function(o){t.$apply(function(){t.user_spam="0"}),$("body .lpro").addClass("none")}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".photo_cv",function(){var e=$(this).attr("p_id"),t=$.grep(o.portfolio_user,function(o){return o.p_id==e});o.p_detail=t,localStorage.setItem("p_detail",JSON.stringify(o.p_detail)),window.location.hash="#/portfolio_detail/"+e}),$(".contant_profile").on("click",".spam",function(){$("body .lpro").removeClass("none"),$.get(base_url+"/api_upload/violation_report/UdsfPLo-098sdfUYH-oodfu/"+localStorage.getItem("user_id")+"/"+t.user_info[0].member_id,function(o){t.$apply(function(){t.user_spam="1"}),$("body .lpro").addClass("none")}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".porfolio_spam",function(){$("body .lpro").removeClass("none");var o=$(this).attr("p_id");$.get(base_url+"/api_upload/portfolio_violation_report/UdsfdfPLo-0df98sdfUYH-oodffu/"+localStorage.getItem("user_id")+"/"+o,function(e){$("body .lpro").addClass("none"),t.$apply(function(){t.portfolio_you.forEach(function(e){e.p_id==o&&(e.report=1)})})}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".portfolio_unviolation",function(){$("body .lpro").removeClass("none");var o=$(this).attr("p_id");$.get(base_url+"/api_upload/portfolio_unviolation_report/UdsfsdfdfPLo-0df98sfsdfUYH-oodfdfsfu/"+localStorage.getItem("user_id")+"/"+o,function(e){$("body .lpro").addClass("none"),t.$apply(function(){t.portfolio_you.forEach(function(e){e.p_id==o&&(e.report=null)})})}).fail(function(){$("body .alert .msg").text("خطا در اتصال - مجدد تلاش نمایید ").parent(".alert").removeClass("none"),$("body .lpro").addClass("none")})}),$(".cv_list").on("click",".share_btn",function(){var o=$(this).attr("share_url");share_fn(o)})}}});